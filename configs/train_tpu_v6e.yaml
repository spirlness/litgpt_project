# TPU v6e-1 optimized config
out_dir: ./checkpoints
precision: bf16-true  # TPU supports native BF16, which is more stable than FP16
tokenizer_dir: ./data/tokenizer

# TPU settings
accelerator: tpu
devices: 1  # v6e-1 is a single device slice
num_nodes: 1
strategy: auto  # Use SingleDeviceXLAStrategy automatically

data:
  class_path: litgpt.data.TextFiles
  init_args:
    train_data_path: ./data/custom_text/train
    val_data_path: ./data/custom_text/val
    num_workers: 0  # XLA sometimes dislikes multiprocessing dataloaders, 0 is safest

train:
  global_batch_size: 128
  log_interval: 1
  max_tokens: 1000000000
  lr_warmup_steps: 10
  micro_batch_size: 8  # TPU v6e has high HBM, we can likely fit 8 or more
  save_interval: 1000
  gradient_checkpointing: true
  max_norm: 1.0
  max_seq_length: 512

optimizer:
  class_path: muon.MuonWithAuxAdam
  init_args:
    muon_lr: 0.01
    muon_momentum: 0.95
    muon_weight_decay: 0.01
    adam_lr: 0.0003
    adam_betas: [0.9, 0.95]
    adam_eps: 1.0e-8
    adam_weight_decay: 0.01
